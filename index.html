<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Next-Gen AI Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    }
    .glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="h-screen flex text-white font-sans">

  <!-- Sidebar -->
  <div class="w-64 glass border-r border-white/10 flex flex-col">
    <div class="p-6 border-b border-white/10">
      <h1 class="text-2xl font-bold">‚ú® Nova</h1>
      <p class="text-sm text-gray-300">Your AI, smarter than ever</p>
    </div>
    <div id="history" class="flex-1 overflow-y-auto p-4 space-y-2 scrollbar-hide"></div>
    <div class="p-4 border-t border-white/10">
      <button onclick="clearMemory()" class="w-full py-2 rounded-lg glass text-sm hover:bg-white/10 transition">üóëÔ∏è Clear Memory</button>
    </div>
  </div>

  <!-- Chat -->
  <div class="flex-1 flex flex-col">
    <!-- Messages -->
    <div id="chat" class="flex-1 overflow-y-auto p-6 space-y-4 scrollbar-hide"></div>

    <!-- Input -->
    <div class="p-4 border-t border-white/10 glass">
      <form id="chat-form" class="flex items-center space-x-2">
        <input id="user-input" type="text" placeholder="Type your message..."
          class="flex-1 p-3 rounded-xl bg-white/10 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400">
        <button class="p-3 rounded-xl bg-gradient-to-r from-purple-500 to-blue-500 hover:opacity-80 transition">
          ‚û§
        </button>
      </form>
    </div>
  </div>

<script>
const MODEL = "gpt-5-nano"; 
const SYSTEM_PROMPT = `
You are Nova, a brilliant and friendly AI assistant.
- Always helpful, clear, and concise.
- Speak in a modern, approachable tone.
- If math or algebra, show steps.
- If asked for advice, be empathetic.
- Never break character.
`; 

// Load memory
let memory = JSON.parse(localStorage.getItem("chatMemory")) || [];

// Elements
const chat = document.getElementById("chat");
const historyEl = document.getElementById("history");

// Render memory on load
function renderMemory() {
  chat.innerHTML = "";
  historyEl.innerHTML = "";
  memory.forEach((msg, i) => {
    if (msg.role !== "system") addMessage(msg.role, msg.content, false);
    if (msg.role === "user") {
      const btn = document.createElement("button");
      btn.textContent = msg.content.slice(0,30) + "...";
      btn.className = "w-full text-left text-sm glass px-3 py-2 rounded hover:bg-white/10 transition";
      btn.onclick = () => scrollToMessage(i);
      historyEl.appendChild(btn);
    }
  });
}
renderMemory();

function scrollToMessage(index) {
  const el = document.querySelector(`[data-idx="${index}"]`);
  if (el) el.scrollIntoView({ behavior: "smooth" });
}

function saveMemory() {
  localStorage.setItem("chatMemory", JSON.stringify(memory));
}

function clearMemory() {
  memory = [{ role: "system", content: SYSTEM_PROMPT }];
  saveMemory();
  renderMemory();
}

function addMessage(role, text, push=true) {
  const idx = memory.length;
  const bubble = document.createElement("div");
  bubble.dataset.idx = idx;
  bubble.className = `max-w-xl px-4 py-3 rounded-2xl shadow-md glass animate-fade-in
    ${role === "user" ? "self-end bg-blue-600/60" : "self-start bg-purple-600/40"}`;
  bubble.innerHTML = `<p class="whitespace-pre-line">${text}</p>`;
  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;

  if (push) {
    memory.push({ role, content: text });
    saveMemory();
    renderMemory();
  }
}

// Send to AI
async function askAI(input) {
  addMessage("user", input);

  // Prepare conversation
  const messages = memory.map(m => ({ role: m.role, content: [{ type: "text", text: m.content }] }));

  let aiText = "";
  const bubble = document.createElement("div");
  bubble.className = "max-w-xl px-4 py-3 rounded-2xl shadow-md glass self-start bg-purple-600/40 animate-fade-in";
  bubble.innerHTML = `<p class="whitespace-pre-line">...</p>`;
  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;

  try {
    const resp = await puter.ai.chat(messages, { model: MODEL, stream: true });
    for await (const part of resp) {
      if (part?.text) {
        aiText += part.text;
        bubble.innerHTML = `<p class="whitespace-pre-line">${aiText}</p>`;
        chat.scrollTop = chat.scrollHeight;
      }
    }
    memory.push({ role: "assistant", content: aiText });
    saveMemory();
    renderMemory();
  } catch (e) {
    console.error("AI error:", e);
    bubble.innerHTML = `<p class="text-red-400">‚ö†Ô∏è Error: ${e.message || "Failed to connect"}</p>`;
  }
}

// Form handler
document.getElementById("chat-form").addEventListener("submit", e => {
  e.preventDefault();
  const input = document.getElementById("user-input");
  if (!input.value.trim()) return;
  askAI(input.value.trim());
  input.value = "";
});

// Initialize system prompt if missing
if (!memory.find(m => m.role === "system")) {
  memory.unshift({ role: "system", content: SYSTEM_PROMPT });
  saveMemory();
}
</script>
</body>
</html>
